<?xml version="1.0"?>
<!--
Copyright (c), 2016, Quantum Espresso Foundation. All rights reserved.
This file is distributed under the terms of the MIT License. See the
file 'LICENSE' in the root directory of the present distribution, or
http://opensource.org/licenses/MIT.
Authors: Paolo Giannozzi, Pietro Delugas
-->
<schema xmlns="http://www.w3.org/2001/XMLSchema"
        xmlns:neb="http://www.quantum-espresso.org/ns/neb"
        targetNamespace="http://www.quantum-espresso.org/ns/neb">
    <element name="nebRun" type="neb:NebRunType"/>
    <complexType name="NebRunType">
        <sequence>
            <element name="GeneralInfo" type="neb:general_infoType" minOccurs="0"/>
            <element name="ParallelInfo" type="neb:nebPInfoType" minOccurs="0"/>
            <element name="input" type="neb:nebInputType" minOccurs="1" maxOccurs="1"/>
            <element name="nebStep" type="neb:nebStepType" minOccurs="0" maxOccurs="unbounded" />
            <element name="nebOutput" type="neb:nebOutputType" minOccurs="0" maxOccurs="1"/>
            <element type="nonNegativeInteger" name="CpuTime" minOccurs="0"/>
            <element type="neb:statusType" name="status" minOccurs="0" />
            <element type="neb:closedType" name="closed" minOccurs="0"/>
        </sequence>
    </complexType>
    <complexType name="nebPInfoType">
        <sequence>
            <element type="positiveInteger" name="nimages"/>
            <element type="neb:parallel_infoType" name="parallelInfo"/>
        </sequence>
    </complexType>

    <complexType name="nebInputType">
        <sequence>
            <element name="path"    type="neb:pathInputType"/>
            <element name="engine"  type="neb:engineInputType"/>
        </sequence>
    </complexType>

    <complexType name="pathInputType">
        <sequence>
            <element name="stringMethod" type="neb:stringMethodType"/>
            <element type="neb:controlRestartModeType" name="restart_mode" maxOccurs="1" default="from_scratch"/>
            <element type="positiveInteger" name="pathNstep" maxOccurs="1" minOccurs="1"/>
            <element type="positiveInteger" name="numOfImages" minOccurs ="0"/>
            <element name="optimizationScheme" type="neb:optimizationSchemeType" minOccurs="1" maxOccurs="1"/>
            <element name="climbingImage" type="neb:climbingImageType" maxOccurs="1" default="no-CI"/>
            <element name="endImagesOptimizationFlag" type="boolean" maxOccurs="1" default="false"/>
            <element name="minimumImageFlag" type="boolean" maxOccurs="1" default="false"/>
            <element name="temperature" type="double" minOccurs="0" maxOccurs="1" />
            <element name="optimizationStepLength" type="double" minOccurs="1" maxOccurs="1" />
            <element name="pathThreshold" type="double"/>
            <element name="elasticConstMax" type="double" minOccurs="1" maxOccurs="1" />
            <element name="elasticConstMin" type="double" minOccurs="1" maxOccurs="1"/>
            <element name="useMassesFlag" type="boolean" default="false" maxOccurs="1"/>
            <element name="useFreezingFlag" type="boolean" default="false" maxOccurs="1"/>
            <element name="constantBiasFlag" type="boolean" default="false" minOccurs="0" maxOccurs="1"/>
            <element name="targetFermiEnergy" type="double" minOccurs="0" maxOccurs="1"/>
            <element name="totChargeFirst" type="double" minOccurs="0" maxOccurs="1"/>
            <element name="totChargeLast" type="double" minOccurs="0" maxOccurs="1" />
            <element name="climbingImageIndex" type="positiveInteger" minOccurs="0" maxOccurs="unbounded"/>
        </sequence>
    </complexType>
    <complexType name="engineInputType">
        <sequence>
            <element type="neb:control_variablesType" name="control_variables"/>
            <element type="neb:atomic_speciesType" name="atomic_species" />
            <element name="atomic_structure" type="neb:atomic_structureType" minOccurs="2" maxOccurs="unbounded"/>
            <element type="neb:dftType" name="dft"/>
            <element type="neb:spinType" name="spin" />
            <element type="neb:bandsType" name="bands"/>
            <element type="neb:basisType" name="basis"/>
            <element type="neb:electron_controlType" name="electron_control"/>
            <element type="neb:k_points_IBZType" name="k_points_IBZ"/>
            <element type="neb:ion_controlType" name="ion_control"/>
            <element type="neb:cell_controlType" name="cell_control"/>
            <element type="neb:symmetry_flagsType" name="symmetry_flags" minOccurs="0" />
            <element type="neb:boundary_conditionsType" name="boundary_conditions" minOccurs="0" />
            <element type="neb:ekin_functionalType" name="ekin_functional" minOccurs="0" />
            <element type="neb:matrixType" name="external_atomic_forces" minOccurs="0" />
            <element type="neb:matrixType" name="free_positions" minOccurs="0" />
            <element type="neb:matrixType" name="starting_atomic_velocities" minOccurs="0" />
            <element type="neb:electric_fieldType" name="electric_field" minOccurs="0" />
            <element type="neb:atomic_constraintsType" name="atomic_constraints" minOccurs="0" />
            <element type="neb:spin_constraintsType" name="spin_constraints" minOccurs="0" />
        </sequence>
    </complexType>

    <complexType name="nebStepType">
        <sequence>
            <element name="Iteration" type="positiveInteger"/>
            <element name="ActivationEnergyForward" type="double" />
            <element name="ActivationEnergyBack" type="double"/>
            <element name="Bead" type="neb:nebBeadType" maxOccurs="unbounded"/>
            <element name="pathLength" type="double"/>
            <element name="InterBeadDistance" type="double"/>
        </sequence>
    </complexType>
    <complexType name="nebOutputType">
        <sequence>
            <element name="finalNebStep" type="neb:nebStepType"/>
            <element name="nebControl" type="neb:engineInputType"  />
            <element name="nebPlot" type="neb:plotType"/>
            <element name="finalImageGradient" type="neb:imageGradientType" maxOccurs="unbounded"/>
        </sequence>
    </complexType>

    <complexType name="imageGradientType">
        <sequence>
            <element name="imageNumber" type="positiveInteger"/>
            <element name="gradient" type="neb:matrixType"/>
        </sequence>
    </complexType>
    <complexType name="plotType">
        <sequence>
            <element name="Abscissae" type="neb:vectorType"/>
            <element name="Ordinates" type="neb:vectorType"/>
        </sequence>
    </complexType>
    <complexType name="nebBeadType">
        <sequence>
            <element name="ImageIndex" type="positiveInteger"/>
            <element name="Energy" type="double"/>
            <element name="Error" type="double"/>
            <element name="FrozenFlag" type="boolean"/>
            <element name="Structure" type="neb:atomic_structureType"/>
        </sequence>
    </complexType>

    <simpleType name="stringMethodType">
        <restriction base="string">
            <enumeration value="neb"/>
            <enumeration value="smd"/>
        </restriction>
    </simpleType>
    <simpleType name="optimizationSchemeType">
        <restriction base="string">
            <enumeration value="sd"/>
            <enumeration value="broyden"/>
            <enumeration value="broyden2"/>
            <enumeration value="quick-min"/>
            <enumeration value="langevin"/>
        </restriction>
    </simpleType>
    <simpleType name="climbingImageType">
        <restriction base="string">
            <enumeration value="no-CI"/>
            <enumeration value="auto"/>
            <enumeration value="manual"/>
        </restriction>
    </simpleType>
    <complexType name="manyPosStructType">
        <sequence>
            <choice minOccurs="2" maxOccurs="unbounded">
                <element type="neb:atomic_positionsType" name="atomic_positions" minOccurs="2" maxOccurs="unbounded" />
                <element type="neb:wyckoff_positionsType" name="wyckoff_positions" minOccurs="0" maxOccurs="unbounded" />
            </choice>
            <element type="neb:cellType" name="cell"/>
        </sequence>
        <attribute type="positiveInteger" name="nat" />
        <attribute type="double" name="alat" use="optional"/>
        <attribute type="positiveInteger" name="bravais_index" use="optional"/>
    </complexType>


  <!-- GENERAL INFO -->
  <complexType name="general_infoType">
    <sequence>
      <element type="neb:xml_formatType" name="xml_format"/>
      <element type="neb:creatorType" name="creator"/>
      <element type="neb:createdType" name="created"/>
      <element type="string" name="job"/>
    </sequence>
  </complexType>
  <!-- PARALLEL INFO -->
  <complexType name="parallel_infoType">
    <sequence>
      <element type="positiveInteger" name="nprocs"/>
      <element type="positiveInteger" name="nthreads"/>
      <element type="positiveInteger" name="ntasks"/>
      <element type="positiveInteger" name="nbgrp"/>
      <element type="positiveInteger" name="npool"/>
      <element type="positiveInteger" name="ndiag"/>
    </sequence>
  </complexType>
  <!-- INPUT TYPE-->
  <complexType name="inputType">
    <sequence>
      <element type="neb:control_variablesType" name="control_variables"/>
      <element type="neb:atomic_speciesType" name="atomic_species"/>
      <element type="neb:atomic_structureType" name="atomic_structure"/>
      <element type="neb:dftType" name="dft"/>
      <element type="neb:spinType" name="spin"/>
      <element type="neb:bandsType" name="bands"/>
      <element type="neb:basisType" name="basis"/>
      <element type="neb:electron_controlType" name="electron_control"/>
      <element type="neb:k_points_IBZType" name="k_points_IBZ"/>
      <element type="neb:ion_controlType" name="ion_control"/>
      <element type="neb:cell_controlType" name="cell_control"/>
      <element type="neb:symmetry_flagsType" name="symmetry_flags" minOccurs="0" />
      <element type="neb:boundary_conditionsType" name="boundary_conditions" minOccurs="0" />
      <element type="neb:ekin_functionalType" name="ekin_functional" minOccurs="0" />
      <element type="neb:matrixType" name="external_atomic_forces" minOccurs="0" />
      <element type="neb:integerMatrixType" name="free_positions" minOccurs="0" />
      <element type="neb:matrixType" name="starting_atomic_velocities" minOccurs="0" />
      <element type="neb:electric_fieldType" name="electric_field" minOccurs="0" />
      <element type="neb:atomic_constraintsType" name="atomic_constraints" minOccurs="0" />
      <element type="neb:spin_constraintsType" name="spin_constraints" minOccurs="0" />
    </sequence>
  </complexType>
  <!-- STEP TYPE -->
  <complexType name="stepType">
    <sequence>
      <element type="neb:scf_convType" name="scf_conv"/>
      <element type="neb:atomic_structureType" name="atomic_structure"/>
      <element type="neb:total_energyType" name="total_energy"/>
      <element type="neb:matrixType" name="forces"/>
      <element type="neb:matrixType" name="stress" minOccurs="0" />
      <element type="double"         name="FCP_force" minOccurs="0"/>
      <element type="double"         name="FCP_tot_charge" minOccurs ="0"/>
    </sequence>
    <attribute type="positiveInteger" name="n_step"/>
  </complexType>
  <!-- OUTPUT TYPE -->
  <complexType name="outputType">
    <sequence>
      <element type="neb:convergence_infoType" name="convergence_info"/>
      <element type="neb:algorithmic_infoType" name="algorithmic_info"/>
      <element type="neb:atomic_speciesType" name="atomic_species"/>
      <element type="neb:atomic_structureType" name="atomic_structure"/>
      <element type="neb:symmetriesType" name="symmetries" minOccurs="0" maxOccurs="1"/>
      <element type="neb:basis_setType" name="basis_set"/>
      <element type="neb:dftType" name="dft"/>
      <element type="neb:magnetizationType" name="magnetization"/>
      <element type="neb:total_energyType" name="total_energy"/>
      <element type="neb:band_structureType" name="band_structure"/>
      <element type="neb:matrixType" name="forces" minOccurs="0"/>
      <element type="neb:matrixType" name="stress" minOccurs="0" />
      <element type="neb:outputElectricFieldType" name="electric_field" minOccurs="0" />
      <element type="double"  name="FCP_force" minOccurs="0"/>
      <element type="double"  name="FCP_tot_charge" minOccurs="0"/>
    </sequence>
  </complexType>
  <!-- CONTROL -->
  <complexType name="control_variablesType">
    <sequence>
      <element type="string" name="title"/>
      <element type="neb:calculationType" name="calculation" default="scf"/>
      <element type="neb:controlRestartModeType" name="restart_mode" default="from_scratch"/>
      <element type="string" name="prefix"/>
      <element type="string" name="pseudo_dir"/>
      <element type="string" name="outdir"/>
      <element type="boolean" name="stress"/>
      <element type="boolean" name="forces"/>
      <element type="boolean" name="wf_collect" default="false"/>
      <element type="neb:lowhighType" name="disk_io" default="low"/>
      <element type="positiveInteger" name="max_seconds"/>
      <element type="positiveInteger" name="nstep" minOccurs="0"/>
      <element type="double" name="etot_conv_thr" default="1.0e-5"/>
      <element type="double" name="forc_conv_thr" default="1.0e-3"/>
      <element type="double" name="press_conv_thr" default="5e-1"/>
      <element type="neb:lowhighType" name="verbosity" default="low"/>
      <element type="positiveInteger" name="print_every"/>
    </sequence>
  </complexType>
  <!-- COMMON TYPES -->
  <!-- GENERAL INFO -->
  <complexType name="xml_formatType">
    <simpleContent>
      <extension base="string">
        <attribute type="string" name="NAME"/>
        <attribute type="string" name="VERSION"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="creatorType">
    <simpleContent>
      <extension base="string">
        <attribute type="string" name="NAME"/>
        <attribute type="string" name="VERSION"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="createdType">
    <simpleContent>
      <extension base="string">
        <attribute type="string" name="DATE"/>
        <attribute type="string" name="TIME"/>
      </extension>
    </simpleContent>
  </complexType>
  <!-- CONTROL -->
  <simpleType name="calculationType">
  	<restriction base="string">
   <enumeration value="scf"/>
  	<enumeration value="nscf"/>
  	<enumeration value="bands"/>
  	<enumeration value="relax"/>
  	<enumeration value="vc-relax"/>
  	<enumeration value="md"/>
  	<enumeration value="vc-md"/>
  	</restriction>
  </simpleType>
  <simpleType name="controlRestartModeType">
  	<restriction base="string">
    <enumeration value="from_scratch"/>
  	<enumeration value="restart"/>
  	</restriction>
  </simpleType>
  <simpleType name="lowhighType">
  	<restriction base="string">
  	  <enumeration value="low"/>
  	  <enumeration value="high"/>
  	</restriction>
  </simpleType>
  <!-- INPUT TYPE -->
  <complexType name="atomic_speciesType">
    <sequence>
      <element type="neb:speciesType" name="species" maxOccurs="unbounded"/>
    </sequence>
    <attribute type="positiveInteger" name="ntyp"/>
  </complexType>
  <complexType name="speciesType">
    <sequence>
      <element type="double" name="mass" minOccurs="0" />
      <element type="string" name="pseudo_file"/>
      <element type="double" name="starting_magnetization" minOccurs="0" default="0.0"/>
      <element type="double" name="spin_teta" minOccurs="0" maxOccurs="1" />
      <element type="double" name="spin_phi"  minOccurs="0" maxOccurs="1" />
    </sequence>
    <attribute type="string" name="name"/>
  </complexType>
  <complexType name="atomic_structureType">
    <sequence>
      <choice minOccurs="1" maxOccurs="1">
         <element type="neb:atomic_positionsType" name="atomic_positions" minOccurs="0"  />
         <element type="neb:wyckoff_positionsType" name="wyckoff_positions" minOccurs="0" />
      </choice>
      <element type="neb:cellType" name="cell"/>
    </sequence>
    <attribute type="positiveInteger" name="nat" />
    <attribute type="double" name="alat" use="optional"/>
    <attribute type="positiveInteger" name="bravais_index" use="optional"/>
  </complexType>
  <complexType name="atomic_positionsType">
    <sequence>
      <element type="neb:atomType" name="atom" maxOccurs="unbounded" />
    </sequence>
  </complexType>
  <complexType name="atomType">
    <simpleContent>
      <extension base="neb:d3vectorType">
    	<attribute type="string" name="name" />
    	<attribute type="string" name="position" use="optional" />
        <attribute type="positiveInteger" name="index" use="optional"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="wyckoff_positionsType">
    <sequence>
      <element type="neb:atomType" name="atom" maxOccurs="unbounded" />
    </sequence>
    <attribute type="unsignedByte" name="space_group" />
    <attribute type="string" name="more_options" use="optional"/>
  </complexType>
  <complexType name="cellType">
    <sequence>
      <element type="neb:d3vectorType" name="a1"/>
      <element type="neb:d3vectorType" name="a2"/>
      <element type="neb:d3vectorType" name="a3"/>
    </sequence>
  </complexType>
  <complexType name="dftType">
    <sequence>
      <element type="neb:functionalType" name="functional"/>
      <element type="neb:hybridType" name="hybrid" minOccurs="0" />
      <element type="neb:dftUType" name="dftU" minOccurs="0" />
      <element type="neb:vdWType" name="vdW" minOccurs="0" />
    </sequence>
  </complexType>
  <simpleType name="functionalType">
    <restriction base="string">
    <enumeration value="PZ"/>
    <enumeration value="BP"/>
    <enumeration value="PBE"/>
    <enumeration value="REVPBE"/>
    <enumeration value="PBESOL"/>
    <enumeration value="BLYP"/>
    <enumeration value="OLYP"/>
    <enumeration value="PW91"/>
    <enumeration value="WC"/>
    <enumeration value="SOGGA"/>
    <enumeration value="EV93"/>
    <enumeration value="B3LYP"/>
    <enumeration value="PBE0"/>
    <enumeration value="HSE"/>
    <enumeration value="VDW-DF"/>
    <enumeration value="VDW-DF-CX"/>
    <enumeration value="VDW-DF-C09"/>
    <enumeration value="VDW-DF-OB86"/>
    <enumeration value="VDW-DF-OBK8"/>
    <enumeration value="VDW-DF2"/>
    <enumeration value="VDW-DF2-C09"/>
    <enumeration value="VDW-DF2-B86R"/>
    <enumeration value="RVV10"/>
    </restriction>
  </simpleType>

    <complexType name="hybridType">
    <sequence>
      <element type="neb:qpoint_gridType" name="qpoint_grid"/>
      <element type="double" name="ecutfock"/>
      <element type="double" name="exx_fraction"/>
      <element type="double" name="screening_parameter"/>
      <element type="string" name="exxdiv_treatment"/>
      <element type="boolean" name="x_gamma_extrapolation"/>
      <element type="double" name="ecutvcut"/>
    </sequence>
  </complexType>
  <complexType name="qpoint_gridType">
    <simpleContent>
      <extension base="string">
        <attribute type="positiveInteger" name="nqx1"/>
        <attribute type="positiveInteger" name="nqx2"/>
        <attribute type="positiveInteger" name="nqx3"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="dftUType">
    <sequence>
      <element type="unsignedByte" name="lda_plus_u_kind" minOccurs="0"/>
      <element type="neb:HubbardCommonType" name="Hubbard_U" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:HubbardCommonType" name="Hubbard_J0" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:HubbardCommonType" name="Hubbard_alpha" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:HubbardCommonType" name="Hubbard_beta" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:HubbardJType" name="Hubbard_J" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:starting_nsType" name="starting_ns" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:Hubbard_nsType" name="Hubbard_ns" minOccurs="0" maxOccurs="unbounded"/>
      <element type="neb:HubbardProjType" name="U_projection_type" minOccurs="0"/>
    </sequence>
  </complexType>
  <complexType name="HubbardCommonType">
    <simpleContent>
      <extension base="double">
        <attribute type="string" name="specie"/>
        <attribute type="string" name="label"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="HubbardJType">
    <simpleContent>
      <extension base="neb:d3vectorType">
        <attribute type="string" name="specie"/>
        <attribute type="string" name="label"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="starting_nsType">
    <simpleContent>
      <extension base="neb:vectorType">
        <attribute type="string" name="specie"/>
        <attribute type="string" name="label"/>
        <attribute type="positiveInteger" name="spin"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="Hubbard_nsType">
    <simpleContent>
      <extension base="neb:matrixType">
        <attribute type="string" name="specie"/>
        <attribute type="string" name="label"/>
        <attribute type="positiveInteger" name="spin"/>
        <attribute type="positiveInteger" name="index"/>
      </extension>
    </simpleContent>
  </complexType>
  <simpleType name="HubbardProjType">
     <restriction base="string">
        <enumeration value="atomic"/>
        <enumeration value="ortho-atomic"/>
        <enumeration value="norm-atomic"/>
        <enumeration value="pseudo"/>
        <enumeration value="file"/>
     </restriction>
  </simpleType>
  <complexType name="vdWType">
    <sequence>
      <element type="string" name="vdw_corr"/>
      <element type="string" name = "non_local_term" minOccurs = "0" />
      <element type="double" name="london_s6" minOccurs="0"/>
      <element type="double" name ="ts_vdw_econv_thr" minOccurs="0" maxOccurs="1"/>
      <element type="boolean" name ="ts_vdw_isolated" minOccurs="0" maxOccurs="1"/>
      <element type="double" name="london_rcut" minOccurs="0"/>
      <element type="double" name="xdm_a1" minOccurs="0"/>
      <element type="double" name="xdm_a2" minOccurs="0"/>
      <element type="neb:HubbardCommonType" name = "london_c6" minOccurs="0" maxOccurs="unbounded"/>
    </sequence>
  </complexType>
  <complexType name="spinType">
    <sequence>
      <element type="boolean" name="lsda"/>
      <element type="boolean" name="noncolin"/>
      <element type="boolean" name="spinorbit"/>
    </sequence>
  </complexType>
  <complexType name="bandsType">
    <sequence>
      <element type="positiveInteger" name="nbnd" minOccurs="0"/>
      <element type="neb:smearingType" name="smearing" minOccurs="0"/>
      <element type="double" name="tot_charge" minOccurs="0"/>
      <element type="double" name="tot_magnetization" minOccurs="0"/>
      <element type="neb:occupationsType" name="occupations" />
      <element type="neb:inputOccupationsType" name="inputOccupations" minOccurs="0" maxOccurs="2" />
    </sequence>
  </complexType>
  <complexType name="smearingType">
    <simpleContent>
      <extension base="neb:smearingChoiceType">
        <attribute type="double" name="degauss"/>
      </extension>
    </simpleContent>
  </complexType>
  <simpleType name="smearingChoiceType">
    <restriction base="string">
    <enumeration value="gaussian"/>
    <enumeration value="mp"/>
    <enumeration value="mv"/>
    <enumeration value="fd"/>
    </restriction>
  </simpleType>
  <complexType name="occupationsType">
    <simpleContent>
      <extension base="string">
        <attribute type="positiveInteger" name="spin" use="optional"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="basisType">
    <sequence>
      <element type="boolean" name="gamma_only" minOccurs="0" />
      <element type="double" name="ecutwfc" />
      <element type="double" name="ecutrho" minOccurs="0" />
      <element type="neb:basisSetItemType" name="fft_grid" minOccurs="0" />
      <element type="neb:basisSetItemType" name="fft_smooth" minOccurs="0" />
      <element type="neb:basisSetItemType" name="fft_box" minOccurs="0" />
    </sequence>
  </complexType>
  <complexType name="basis_setType">
    <sequence>
      <element type="boolean" name="gamma_only" minOccurs="0" />
      <element type="double" name="ecutwfc" />
      <element type="double" name="ecutrho" minOccurs="0" />
      <element type="neb:basisSetItemType" name="fft_grid" />
      <element type="neb:basisSetItemType" name="fft_smooth" minOccurs="0" />
      <element type="neb:basisSetItemType" name="fft_box" minOccurs="0" />
      <element type="positiveInteger" name="ngm" />
      <element type="positiveInteger" name="ngms" minOccurs="0" />
      <element type="positiveInteger" name="npwx" />
      <element type="neb:reciprocal_latticeType" name="reciprocal_lattice" />
    </sequence>
  </complexType>
  <complexType name="basisSetItemType">
    <simpleContent>
      <extension base="string">
        <attribute type="positiveInteger" name="nr1"/>
        <attribute type="positiveInteger" name="nr2"/>
        <attribute type="positiveInteger" name="nr3"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="reciprocal_latticeType">
    <sequence>
      <element type="neb:d3vectorType" name="b1"/>
      <element type="neb:d3vectorType" name="b2"/>
      <element type="neb:d3vectorType" name="b3"/>
    </sequence>
  </complexType>
  <complexType name="electron_controlType">
    <sequence>
      <element type="neb:diagoType" name="diagonalization"/>
      <element type="neb:mixingModeType" name="mixing_mode"/>
      <element type="double" name="mixing_beta"/>
      <element type="double" name="conv_thr"/>
      <element type="positiveInteger" name="mixing_ndim"/>
      <element type="positiveInteger" name="max_nstep"/>
      <element type="boolean" name="real_space_q"/>
      <element type="boolean" name="tq_smoothing"/>
      <element type="boolean" name="tbeta_smoothing"/>
      <element type="double" name="diago_thr_init"/>
      <element type="boolean" name="diago_full_acc"/>
      <element type="nonNegativeInteger" name="diago_cg_maxiter"/>
    </sequence>
  </complexType>
  <simpleType name="mixingModeType">
    <restriction base="string">
      <enumeration value="plain"/>
      <enumeration value="TF"/>
      <enumeration value="local-TF"/>
    </restriction>
  </simpleType>
  <simpleType name="diagoType">
    <restriction base="string">
    <enumeration value="davidson"/>
    <enumeration value="cg"/>
    </restriction>
  </simpleType>
  <complexType name="k_points_IBZType">
    <choice minOccurs="1" maxOccurs="1">
      <element type="neb:monkhorst_packType" name="monkhorst_pack" minOccurs="0" maxOccurs="1"/>
      <sequence>
        <element type="positiveInteger" name="nk" minOccurs="0"/>
        <element type="neb:k_pointType" name="k_point" maxOccurs="unbounded" minOccurs="0"/>
      </sequence>
    </choice>
  </complexType>
  <complexType name="monkhorst_packType">
    <simpleContent>
      <extension base="string">
        <attribute type="positiveInteger" name="nk1"/>
        <attribute type="positiveInteger" name="nk2"/>
        <attribute type="positiveInteger" name="nk3"/>
        <attribute type="nonNegativeInteger" name="k1"/>
        <attribute type="nonNegativeInteger" name="k2"/>
        <attribute type="nonNegativeInteger" name="k3"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="k_pointType">
    <simpleContent>
      <extension base="neb:d3vectorType">
        <attribute type="double" name="weight" use="optional"/>
        <attribute type="string" name="label" use = "optional"/>  
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="ion_controlType">
    <sequence>
      <element type="string" name="ion_dynamics" minOccurs="0"/>
      <element type="double" name="upscale" minOccurs="0" />
      <element type="boolean" name="remove_rigid_rot" minOccurs="0" />
      <element type="boolean" name="refold_pos" minOccurs="0" />
      <element type="neb:bfgsType" name="bfgs" minOccurs="0" />
      <element type="neb:mdType" name="md" minOccurs="0" />
    </sequence>
  </complexType>
  <complexType name="bfgsType">
    <sequence>
      <element type="positiveInteger" name="ndim"/>
      <element type="double" name="trust_radius_min"/>
      <element type="double" name="trust_radius_max"/>
      <element type="double" name="trust_radius_init"/>
      <element type="double" name="w1"/>
      <element type="double" name="w2"/>
    </sequence>
  </complexType>
  <complexType name="mdType">
    <sequence>
      <element type="string" name="pot_extrapolation"/>
      <element type="string" name="wfc_extrapolation"/>
      <element type="string" name="ion_temperature"/>
      <element type="double" name="timestep" default="20.0" maxOccurs='1'/>
      <element type="double" name="tempw"/>
      <element type="double" name="tolp"/>
      <element type="double" name="deltaT"/>
      <element type="positiveInteger" name="nraise"/>
    </sequence>
  </complexType>
  <complexType name="cell_controlType">
    <sequence>
      <element type="string" name="cell_dynamics" minOccurs ="0"/>
      <element type="double" name="pressure" default="0.0" minOccurs ="0" />
      <element type="double" name="wmass" minOccurs="0" />
      <element type="double" name="cell_factor" minOccurs="0" />
      <element type="boolean" name="fix_volume" minOccurs="0" />
      <element type="boolean" name="fix_area"   minOccurs="0" />
      <element type="boolean" name="isotropic" minOccurs="0" />
      <element type="neb:integerMatrixType" name="free_cell" minOccurs="0" />
    </sequence>
  </complexType>
  <complexType name="symmetry_flagsType">
    <sequence>
      <element type="boolean" name="nosym"/>
      <element type="boolean" name="nosym_evc"/>
      <element type="boolean" name="noinv"/>
      <element type="boolean" name="no_t_rev"/>
      <element type="boolean" name="force_symmorphic"/>
      <element type="boolean" name="use_all_frac"/>
    </sequence>
  </complexType>
  <complexType name="boundary_conditionsType">
    <sequence>
      <element type="string" name="assume_isolated"/>
      <element type="neb:esmType" name="esm" minOccurs = "0"/>
      <element type="boolean"     name="fcp_opt" minOccurs = "0"/>
      <element type="double" name="fcp_mu" minOccurs ="0" /> 
    </sequence>
  </complexType>
  <complexType name="esmType">
    <sequence>
      <element type="string" name="bc"/>
      <element type="positiveInteger" name="nfit"/>
      <element type="double" name="w"/>
      <element type="double" name="efield"/>
    </sequence>
  </complexType>
  <complexType name="ekin_functionalType">
    <sequence>
      <element type="double" name="ecfixed"/>
      <element type="double" name="qcutz"/>
      <element type="double" name="q2sigma"/>
    </sequence>
  </complexType>
  <complexType name="spin_constraintsType">
    <sequence>
      <element type="string" name="spin_constraints"/>
      <element type="double" name="lagrange_multiplier"/>
      <element type="neb:d3vectorType" name="target_magnetization" minOccurs="0" maxOccurs="1"/>
    </sequence>
  </complexType>
  <complexType name="electric_fieldType">
    <sequence>
       <element type="neb:electric_potentialType"  name="electric_potential" minOccurs="1" maxOccurs="1"/>
       <element type="boolean" name="dipole_correction" minOccurs="0" maxOccurs="1" default="false"/>
       <element type="integer" name="electric_field_direction" minOccurs="0" maxOccurs="1"/>
       <element type="double"  name="potential_max_position" minOccurs="0" maxOccurs="1"/>
       <element type="double"  name="potential_decrease_width" minOccurs="0" maxOccurs="1"/>
       <element type="double"  name="electric_field_amplitude"      minOccurs="0" maxOccurs="1"/>
       <element type="neb:d3vectorType" name="electric_field_vector" minOccurs="0" maxOccurs="1"/>
       <element type="integer"          name="nk_per_string"  minOccurs="0"  maxOccurs="1"/>
       <element type="integer"   name = "n_berry_cycles" minOccurs="0" maxOccurs="1"/>
    </sequence>
  </complexType>
  <simpleType name="electric_potentialType">
     <restriction base="string">
  	<enumeration value="sawtooth_potential"/>
  	<enumeration value="homogenous_field"/>
        <enumeration value="Berry_Phase" />
     </restriction>
  </simpleType>
  <complexType name="atomic_constraintsType" >
    <sequence>
       <element type="integer" name="num_of_constraints" minOccurs="1"  maxOccurs="1"/>
       <element type="double"  name="tolerance"          minOccurs="1" maxOccurs="1"/>
       <element type="neb:atomic_constraintType" name="atomic_constraint" minOccurs="1" maxOccurs="unbounded"/>
    </sequence>
  </complexType>
  <complexType name="atomic_constraintType">
     <sequence>
        <element type="neb:constr_parms_listType" name="constr_parms" />
        <element type="neb:constr_typeType" name="constr_type"/>
        <element type="double"  name="constr_target" />
     </sequence>
  </complexType>
  <simpleType name="constr_parms_listType">
    <restriction>
       <simpleType>
         <list itemType="double"/>
       </simpleType>
       <length value="4"/>
    </restriction>
  </simpleType>

  <simpleType name= "constr_typeType">
     <restriction base="string">
        <enumeration value="type_coord"/>
        <enumeration value="atom_coord"/>
        <enumeration value="distance"  />
        <enumeration value="planar_angle"/>
        <enumeration value="torsional_angle"/>
        <enumeration value="bennet_proj"/>
     </restriction>
  </simpleType>

  <complexType name="inputOccupationsType">
     <simpleContent>
        <extension base="neb:vectorType">
           <attribute type="positiveInteger" name="ispin"/>
           <attribute type="double" name="spin_factor"/>
        </extension>
     </simpleContent>
  </complexType>

  <!-- OUTPUT TYPE -->

  <complexType name="outputElectricFieldType">
    <sequence>
      <element name="BerryPhase" type="neb:BerryPhaseOutputType" minOccurs="0"/>
      <element name="finiteElectricFieldInfo" type="neb:finiteFieldOutType" minOccurs="0" />
      <element name="dipoleInfo" type="neb:dipoleOutputType" minOccurs="0" />
    </sequence>
  </complexType>
  <complexType name="BerryPhaseOutputType">
    <sequence>
      <element name="polarization" type="neb:polarizationType"  />
      <element name="totalPhase" type="neb:phaseType"/>
      <element name="ionicPolarization" type="neb:ionicPolarizationType" maxOccurs="unbounded"/>
      <element name="electronicPolarization" type="neb:electronicPolarizationType" maxOccurs="unbounded"/>
    </sequence>
  </complexType>

  <complexType name="dipoleOutputType">
    <sequence>
      <element type="positiveInteger" name="idir"/>
      <element type="neb:scalarQuantityType" name = "dipole"/>
      <element type="neb:scalarQuantityType" name = "ion_dipole"/>
      <element type="neb:scalarQuantityType" name = "elec_dipole"/>
      <element type="neb:scalarQuantityType" name="dipoleField"/>
      <element type="neb:scalarQuantityType" name="potentialAmp"/>
      <element type="neb:scalarQuantityType" name="totalLength"/>
    </sequence>
  </complexType>


  <complexType name="finiteFieldOutType">
    <sequence>
      <element type="neb:d3vectorType" name="electronicDipole"/>
      <element type="neb:d3vectorType" name="ionicDipole"/>
    </sequence>
  </complexType>

 

  <complexType name="polarizationType">
    <sequence>
      <element type="neb:scalarQuantityType" name="polarization"/>
      <element type="double" name="modulus" />
      <element type="neb:d3vectorType" name="direction"/>
   </sequence>
  </complexType>


  <complexType name="ionicPolarizationType">
    <sequence>
      <element name="ion" type="neb:atomType"/>
      <element name="charge" type="double"/>
      <element name="phase"  type="neb:phaseType"/>
    </sequence>
  </complexType>
 
  <complexType name="electronicPolarizationType">
    <sequence>
      <element name="firstKeyPoint" type="neb:k_pointType"/>
      <element name="spin" type="positiveInteger" minOccurs="0"/>
      <element name="phase" type="neb:phaseType"/>
    </sequence>
  </complexType>

  <complexType name="phaseType">
    <simpleContent>
      <extension base="double">
        <attribute type="double" name="ionic" use="optional"/>
        <attribute type="double" name="electronic" use="optional"/>
        <attribute type="string" name="modulus" use="optional"/>
      </extension>
    </simpleContent>
  </complexType>

  <complexType name="convergence_infoType">
    <sequence>
      <element type="neb:scf_convType" name="scf_conv"/>
      <element type="neb:opt_convType" name="opt_conv" minOccurs="0"/>
    </sequence>
  </complexType>
  <complexType name="scf_convType">
    <sequence>
      <element type="positiveInteger" name="n_scf_steps"/>
      <element type="double" name="scf_error"/>
    </sequence>
  </complexType>
  <complexType name="opt_convType">
    <sequence>
      <element type="positiveInteger" name="n_opt_steps"/>
      <element type="double" name="grad_norm"/>
    </sequence>
  </complexType>
  <complexType name="algorithmic_infoType">
    <sequence>
      <element type="boolean" name="real_space_q"/>
      <element type="boolean" name="uspp"/>
      <element type="boolean" name="paw"/>
    </sequence>
  </complexType>
  <complexType name="symmetriesType">
    <sequence>
      <element type="unsignedByte" name="nsym"/>
      <element type="unsignedByte" name="nrot"/>
      <element type="unsignedByte" name="space_group"/>
      <element type="neb:symmetryType" name="symmetry" maxOccurs="48" minOccurs="1"/>
    </sequence>
  </complexType>
  <complexType name="symmetryType">
    <sequence>
      <element type="neb:infoType" name="info"/>
      <element type="neb:matrixType" name="rotation"/>
      <element type="neb:d3vectorType" name="fractional_translation" minOccurs="0"/>
      <element type="neb:equivalent_atomsType" name="equivalent_atoms" minOccurs="0"/>
    </sequence>
  </complexType>
  <complexType name="equivalent_atomsType">
    <simpleContent>
      <extension base="neb:integerListType">
        <attribute type="positiveInteger" name="nat"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="infoType">
    <simpleContent>
      <extension base="string">
        <attribute type="string" name="name" use="optional"/>
        <attribute  type="string" name="class" use="optional"/>
        <attribute type="boolean" name="time_reversal" use="optional"/>
      </extension>
    </simpleContent>
  </complexType>
  <complexType name="magnetizationType">
    <sequence>
      <element type="boolean" name="lsda"/>
      <element type="boolean" name="noncolin"/>
      <element type="boolean" name="spinorbit"/>
      <element type="double"  name="total"/>
      <element type="double"  name="absolute"/>
      <element type="boolean" name="do_magnetization"/>
    </sequence>
  </complexType>
  <complexType name="total_energyType">
    <sequence>
      <element type="double" name="etot"/>
      <element type="double" name="eband" minOccurs="0"/>
      <element type="double" name="ehart" minOccurs="0"/>
      <element type="double" name="vtxc"  minOccurs="0"/>
      <element type="double" name="etxc"  minOccurs="0"/>
      <element type="double" name="ewald" minOccurs="0"/>
      <element type="double" name="demet" minOccurs="0"/>
      <element type="double" name="efieldcorr" minOccurs="0"/>
      <element type="double" name="potentiostat_contr" minOccurs="0"/> 
    </sequence>
  </complexType>
  <complexType name="band_structureType">
    <sequence>
      <element type="boolean" name="lsda"/>
      <element type="boolean" name="noncolin"/>
      <element type="boolean" name="spinorbit"/>
      <element type="positiveInteger" name="nbnd"/>
      <element type="nonNegativeInteger" name="nbnd_up" minOccurs="0" />
      <element type="nonNegativeInteger" name="nbnd_dw" minOccurs="0" />
      <element type="double" name="nelec"/>
      <element type="integer" name = "num_of_atomic_wfc" minOccurs = "0"/>
      <element type="boolean" name = "wf_collected" />
      <element type="double" name="fermi_energy" minOccurs="0" />
      <element type="double" name="highestOccupiedLevel" minOccurs ="0"/> 
      <element type="neb:vectorType" name="two_fermi_energies" minOccurs="0"/> 
      <element type="neb:k_points_IBZType" name="starting_k_points" />
      <element type="positiveInteger" name="nks"/>
      <element type="neb:occupationsType" name="occupations_kind" />
      <element type="neb:smearingType"    name="smearing" minOccurs="0" /> 
      <element type="neb:ks_energiesType" name="ks_energies" maxOccurs="unbounded"/>
    </sequence>
  </complexType>
  <complexType name="ks_energiesType">
    <sequence>
      <element type="neb:k_pointType" name="k_point"/>
      <element type="positiveInteger" name="npw"/>
      <element type="neb:vectorType" name="eigenvalues"/>
      <element type="neb:vectorType" name="occupations"/>
    </sequence>
  </complexType>
  <complexType name="closedType">
    <simpleContent>
      <extension base="string">
        <attribute type="string" name="DATE"/>
        <attribute type="string" name="TIME"/>
      </extension>
    </simpleContent>
  </complexType>

 <simpleType name="statusType">
      <restriction base="integer">
         <enumeration value="0" />
         <enumeration value="1" />
         <enumeration value="2" />
         <enumeration value="3" />
         <enumeration value="255"/>
      </restriction>
  </simpleType>
  <!-- FPMD TYPES (ref: quantum-simulation.org) -->
  <simpleType name="d3vectorType">
    <restriction>
       <simpleType>
         <list itemType="double"/>
       </simpleType>
       <length value="3"/>
    </restriction>
  </simpleType>
  <simpleType name="vectorType">
    <restriction>
       <simpleType>
         <list itemType="double"/>
       </simpleType>
    </restriction>
  </simpleType>
  <simpleType name="integerListType">
    <restriction>
       <simpleType>
         <list itemType="integer"/>
       </simpleType>
    </restriction>
  </simpleType>
  <simpleType name="doubleListType">
    <list itemType="double"/>
  </simpleType>  
  <complexType name="matrixType">
    <simpleContent>
      <extension base="neb:doubleListType" />
    </simpleContent>
  </complexType>
  <complexType name="integerMatrixType">
    <simpleContent>
      <extension base="neb:integerListType"/>
    </simpleContent>
  </complexType>
  <complexType name="scalarQuantityType">
    <simpleContent>
      <extension base="double">
        <attribute type="string" name="Units"/>
      </extension>
    </simpleContent>
  </complexType>
</schema>
